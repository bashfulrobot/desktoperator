---
# COSMIC theme color variables
# Loads auto-generated color palette for all roles to consume

# Ensure color variables exist (auto-generate if missing)
- name: Check if auto-colors.yml exists
  stat:
    path: "{{ playbook_dir }}/group_vars/all/auto-colors.yml"
  register: auto_colors_file
  delegate_to: localhost
  become: no

- name: Generate color variables if missing
  command: "{{ playbook_dir }}/scripts/generate-color-vars.sh"
  args:
    chdir: "{{ playbook_dir }}"
  delegate_to: localhost
  become: no
  when: not auto_colors_file.stat.exists

- name: Load auto-generated color variables
  include_vars:
    file: "{{ playbook_dir }}/group_vars/all/auto-colors.yml"

# Install extraction script to /usr/local/bin for manual use
- name: Install color extraction script for manual use
  ansible.builtin.copy:
    src: ../../../scripts/extract-cosmic-colors.sh
    dest: /usr/local/bin/extract-cosmic-colors
    mode: '0755'
    owner: root
    group: root
  become: true
