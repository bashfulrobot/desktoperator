---
# Fish shell configuration

- name: Install fish shell
  ansible.builtin.apt:
    name: fish
    state: present
  become: true
  tags: [system]

- name: Create fish config directory
  ansible.builtin.file:
    path: "{{ user.home }}/.config/fish"
    state: directory
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
    mode: "0755"
  become: true
  tags: [system]

- name: Create fish conf.d directory for modular configuration
  ansible.builtin.file:
    path: "{{ user.home }}/.config/fish/conf.d"
    state: directory
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
    mode: "0755"
  become: true
  tags: [system]

- name: Deploy fish config
  ansible.builtin.template:
    src: config.fish.j2
    dest: "{{ user.home }}/.config/fish/config.fish"
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
    mode: "0644"
  become: true
  when: fish_config_enabled | default(true)
  tags: [system]

- name: Deploy general fish functions
  ansible.builtin.template:
    src: fish-general-functions.fish.j2
    dest: "{{ user.home }}/.config/fish/conf.d/general-functions.fish"
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
    mode: "0644"
  become: true
  tags: [system]

- name: Deploy download-logo function
  ansible.builtin.template:
    src: download-logo.fish.j2
    dest: "{{ user.home }}/.config/fish/conf.d/download-logo.fish"
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
    mode: "0644"
  become: true
  tags: [system]

- name: Set fish as default shell
  ansible.builtin.user:
    name: "{{ user.name }}"
    shell: "{{ user.shell }}"
  become: true
  when: user.shell == '/usr/bin/fish'
  tags: [system]

- name: Deploy root bashrc with essential aliases and functions
  ansible.builtin.template:
    src: root-bashrc.j2
    dest: /root/.bashrc
    owner: root
    group: root
    mode: "0644"
  become: true
  when: root_bashrc_enabled | default(true)

  tags: [system]
