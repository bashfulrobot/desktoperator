---
- name: Install font management tools
  ansible.builtin.apt:
    name:
      - fontconfig
      - unzip
    state: present
  become: true
  tags: [fonts, system]

- name: Create system fonts directory
  ansible.builtin.file:
    path: "{{ system_fonts_dir }}"
    state: directory
    mode: '0755'
  become: true
  tags: [fonts, system]

- name: Create fonts state directory
  ansible.builtin.file:
    path: "{{ nerd_fonts_state_dir }}"
    state: directory
    mode: '0755'
  become: true
  tags: [fonts, system]

- name: Process each Nerd Font
  ansible.builtin.include_tasks: install_font.yml
  loop: "{{ nerd_fonts }}"
  loop_control:
    loop_var: font
  tags: [fonts, system]

- name: Update font cache
  ansible.builtin.command: fc-cache -f -v
  become: true
  changed_when: true
  when: fonts_were_updated | default(false)
  tags: [fonts, system]
