---
# konnect Pake App installation
- name: Install konnect .deb package
  ansible.builtin.apt:
    deb: "{{ role_path }}/files/konnect.deb"
    state: present
  become: true
  when: app_states['konnect'] | default('present') == 'present'

- name: Remove .deb desktop files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop:
    - /usr/share/applications/konnect.desktop
    - /usr/share/applications/com.pake.konnect.desktop
  become: true
  when: app_states['konnect'] | default('present') == 'present'

- name: Install custom desktop file and icons
  ansible.builtin.copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: "0644"
  loop:
    - { src: "pake-konnect.desktop", dest: "/usr/share/applications/pake-konnect.desktop" }
    - { src: "pake-konnect-icon-16.png", dest: "/usr/share/icons/hicolor/16x16/apps/pake-konnect.png" }
    - { src: "pake-konnect-icon-32.png", dest: "/usr/share/icons/hicolor/32x32/apps/pake-konnect.png" }
    - { src: "pake-konnect-icon-48.png", dest: "/usr/share/icons/hicolor/48x48/apps/pake-konnect.png" }
    - { src: "pake-konnect-icon-64.png", dest: "/usr/share/icons/hicolor/64x64/apps/pake-konnect.png" }
    - { src: "pake-konnect-icon-128.png", dest: "/usr/share/icons/hicolor/128x128/apps/pake-konnect.png" }
    - { src: "pake-konnect-icon-256.png", dest: "/usr/share/icons/hicolor/256x256/apps/pake-konnect.png" }
    - { src: "pake-konnect-icon-512.png", dest: "/usr/share/icons/hicolor/512x512/apps/pake-konnect.png" }
    - { src: "pake-konnect-icon-800.png", dest: "/usr/share/icons/hicolor/scalable/apps/pake-konnect.png" }
  become: true
  when: app_states['konnect'] | default('present') == 'present'
  notify: Update icon cache

# Cleanup when absent
- name: Remove konnect Pake app
  ansible.builtin.apt:
    name: konnect
    state: absent
    purge: true
  become: true
  when: app_states['konnect'] | default('present') == 'absent'

- name: Remove custom desktop file and icons
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop:
    - /usr/share/applications/pake-konnect.desktop
    - /usr/share/applications/konnect.desktop
    - /usr/share/applications/com.pake.konnect.desktop
    - /usr/share/icons/hicolor/16x16/apps/pake-konnect.png
    - /usr/share/icons/hicolor/32x32/apps/pake-konnect.png
    - /usr/share/icons/hicolor/48x48/apps/pake-konnect.png
    - /usr/share/icons/hicolor/64x64/apps/pake-konnect.png
    - /usr/share/icons/hicolor/128x128/apps/pake-konnect.png
    - /usr/share/icons/hicolor/256x256/apps/pake-konnect.png
    - /usr/share/icons/hicolor/512x512/apps/pake-konnect.png
    - /usr/share/icons/hicolor/scalable/apps/pake-konnect.png
  become: true
  when: app_states['konnect'] | default('present') == 'absent'
  notify: Update icon cache
