---
# sfdc Pake App installation
# Debian package deployment

- name: Install sfdc .deb package
  apt:
    deb: "{{ role_path }}/files/sfdc.deb"
    state: present
  become: yes
  when: app_states['sfdc'] | default('present') == 'present'

- name: Remove .deb desktop files
  file:
    path: "{{ item }}"
    state: absent
  loop:
    - /usr/share/applications/sfdc.desktop
    - /usr/share/applications/com.pake.sfdc.desktop
  become: yes
  when: app_states['sfdc'] | default('present') == 'present'

- name: Remove .deb icon files (all sizes)
  shell: find /usr/share/icons/hicolor -name 'pake-sfdc.png' -delete
  become: yes
  when: app_states['sfdc'] | default('present') == 'present'
  changed_when: false

- name: Install custom desktop file
  copy:
    src: pake-sfdc.desktop
    dest: /usr/share/applications/pake-sfdc.desktop
    mode: '0644'
  become: yes
  when: app_states['sfdc'] | default('present') == 'present'

- name: Install themed icons at all sizes
  copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: '0644'
  loop:
    - { src: 'pake-sfdc-icon-16.png', dest: '/usr/share/icons/hicolor/16x16/apps/pake-sfdc.png' }
    - { src: 'pake-sfdc-icon-32.png', dest: '/usr/share/icons/hicolor/32x32/apps/pake-sfdc.png' }
    - { src: 'pake-sfdc-icon-48.png', dest: '/usr/share/icons/hicolor/48x48/apps/pake-sfdc.png' }
    - { src: 'pake-sfdc-icon-64.png', dest: '/usr/share/icons/hicolor/64x64/apps/pake-sfdc.png' }
    - { src: 'pake-sfdc-icon-128.png', dest: '/usr/share/icons/hicolor/128x128/apps/pake-sfdc.png' }
    - { src: 'pake-sfdc-icon-256.png', dest: '/usr/share/icons/hicolor/256x256/apps/pake-sfdc.png' }
    - { src: 'pake-sfdc-icon-512.png', dest: '/usr/share/icons/hicolor/512x512/apps/pake-sfdc.png' }
    - { src: 'pake-sfdc-icon-800.png', dest: '/usr/share/icons/hicolor/800x800/apps/pake-sfdc.png' }
  become: yes
  when: app_states['sfdc'] | default('present') == 'present'

- name: Update icon cache
  command: gtk-update-icon-cache -f /usr/share/icons/hicolor
  become: yes
  when: app_states['sfdc'] | default('present') == 'present'
  changed_when: false

# Cleanup when absent
- name: Remove sfdc Pake app
  apt:
    name: sfdc
    state: absent
  become: yes
  when: app_states['sfdc'] | default('present') == 'absent'

