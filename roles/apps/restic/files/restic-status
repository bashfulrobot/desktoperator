#!/usr/bin/env bash
set -euo pipefail

# Restic status wrapper script
# Shows backup status and recent snapshots

echo "==================================="
echo "Restic Backup Status"
echo "==================================="
echo ""

# Show autorestic info
echo "Configured backends and locations:"
autorestic info

echo ""
echo "==================================="
echo "Recent Snapshots"
echo "==================================="
echo ""

# Show snapshots for each backend
autorestic exec -a -- snapshots --compact

echo ""
echo "==================================="
echo "Repository Statistics"
echo "==================================="
echo ""

# Show stats for each backend
autorestic exec -a -- stats latest

echo ""
echo "==================================="
echo "Recent Backup Logs"
echo "==================================="
echo ""

LOG_FILE="$HOME/.local/share/autorestic/backup.log"
FAIL_FILE="$HOME/.local/share/autorestic/backup-failures.log"

if [ -f "$LOG_FILE" ]; then
    echo "Last 10 successful backups:"
    tail -10 "$LOG_FILE"
else
    echo "No backup log found at $LOG_FILE"
fi

echo ""

if [ -f "$FAIL_FILE" ]; then
    echo "⚠️  Recent failures:"
    tail -10 "$FAIL_FILE"
else
    echo "✓ No backup failures recorded"
fi
